---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import { Icon } from "astro-icon/components";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      #hello-input {
        border: none;
        background: transparent;

        font-family: "Courier Prime", "Courier New", Courier, monospace;
        font-size: 3em;
        font-weight: bold;
        margin: 0 0 0.5rem 0;
        color: var(--yellow);
        line-height: 1.2;
      }
      #hello-input:focus {
        outline: none;
      }
      #hello-reset {
        color: var(--text);
        background: transparent;
        border: none;
        cursor: pointer;
        transition: 0.2s;
      }
      #hello-reset:hover {
        transform: rotate(-30deg);
      }
      .hero {
        position: relative;
        width: 100%;
        min-height: min(50vw, 20rem);
        display: flex;
        align-items: flex-start;
        overflow: hidden;
      }
      .hero::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          rgba(var(--black), 0.22),
          rgba(var(--black), 0.38)
        );
        z-index: 1;
        pointer-events: none;
      }
      .hero-image {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: 50% 100%;
        z-index: 0;
      }
      .hero-content {
        position: relative;
        z-index: 2;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        padding: 1.5rem 1rem;
      }
      .posts {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .post {
        /* background-color: var(--bg2); */
        padding: 0 1rem;
        border-left: 2px solid var(--yellow);
      }
      .post-info {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
      }
      .post time {
        color: var(--fg2);
        font-style: italic;
        font-size: 0.8em;
      }
      .post-title {
        text-decoration: underline;
      }
      .post-desc {
        color: var(--fg2);
        font-size: 0.9em;
        margin-bottom: 0.5rem;
      }
      .post-dot:not(:last-child) {
        width: 6px;
        height: 6px;
        border: 2px solid var(--yellow);
        /* border-radius: 50%; */
        transform: rotate(45deg);
        margin: -0.5rem 0 0 -1rem;
        position: relative;
        top: 4px;
        left: calc(1rem - 4px);
      }
    </style></head
  >
  <body>
    <Header />
    <main>
      <div class="hero">
        <img class="hero-image" src="/assets/calgary-boardwalk.jpg" alt="" />
        <div class="hero-content">
          <h1>Hello,&nbsp;</h1>
          <input style="width: 23rem" id="hello-input" aria-label="Greeting" />
          <button id="hello-reset" type="button" hidden>
            <Icon name="reset" width="24" height="24" />
          </button>
        </div>
      </div>
      <p>
        The entire internet at your disposal, and yet, you are here. Thanks for
        stopping by, I hope your time here is pleasant.
      </p>

      <h3>Latest Posts</h3>
      <div class="posts">
        {
          posts.map((post) => (
            <div class="post">
              <a href={`/blog/${post.id}/`}>
                <div class="post-title">{post.data.title}</div>
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString("en-us", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  })}
                </time>
                <div class="post-desc">{post.data.description}</div>
              </a>
            </div>
            <div class="post-dot"></div>
          ))
        }
      </div>

      <h3>About Me</h3>
    </main>
    <Footer />
  </body><script>
    const hellos = [
      "Traveller",
      "Wanderer",
      "Friend",
      "Explorer",
      "Adventurer",
    ];
    const randomHello = () => hellos[Math.floor(Math.random() * hellos.length)];
    const helloInput = document.getElementById(
      "hello-input",
    ) as HTMLInputElement;
    const helloReset = document.getElementById(
      "hello-reset",
    ) as HTMLButtonElement;
    const customHelloStorageKey = "hello-heading-custom-text";
    const randomHelloStorageKey = "hello-heading-random-text";
    const savedHello = sessionStorage.getItem(customHelloStorageKey);
    const hasCustomHello =
      typeof savedHello === "string" && savedHello.trim().length > 0;

    const savedSessionHello = sessionStorage.getItem(randomHelloStorageKey);
    const sessionHello =
      typeof savedSessionHello === "string" &&
      savedSessionHello.trim().length > 0
        ? savedSessionHello
        : randomHello();

    if (!savedSessionHello || savedSessionHello.trim().length === 0) {
      sessionStorage.setItem(randomHelloStorageKey, sessionHello);
    }

    helloInput.value = hasCustomHello ? savedHello : sessionHello;
    helloReset.hidden = !hasCustomHello;

    if (hasCustomHello) {
      const customHello = helloInput.value.trim();
      sessionStorage.setItem(customHelloStorageKey, customHello);
      helloReset.hidden = false;
    }

    helloInput.addEventListener("input", () => {
      const customHello = helloInput.value.trim();
      if (customHello.length > 0) {
        sessionStorage.setItem(customHelloStorageKey, customHello);
        helloReset.hidden = false;
        return;
      }

      sessionStorage.removeItem(customHelloStorageKey);
      helloReset.hidden = true;
    });

    helloReset.addEventListener("click", () => {
      sessionStorage.removeItem(customHelloStorageKey);
      const nextHello =
        sessionStorage.getItem(randomHelloStorageKey) ?? randomHello();
      sessionStorage.setItem(randomHelloStorageKey, nextHello);
      helloInput.value = nextHello;
      helloReset.hidden = true;
    });

    const heroImageSources = [
      "/assets/calgary-boardwalk.jpg",
      "/assets/calgary-sky.jpg",
      "/assets/northern-river.jpg",
    ];
    const heroImageStorageKey = "home-hero-image-src";
    const heroImage = document.querySelector(
      ".hero-image",
    ) as HTMLImageElement | null;

    const savedHeroImage = sessionStorage.getItem(heroImageStorageKey);
    const sessionHeroImage =
      savedHeroImage && heroImageSources.includes(savedHeroImage)
        ? savedHeroImage
        : heroImageSources[Math.floor(Math.random() * heroImageSources.length)];

    sessionStorage.setItem(heroImageStorageKey, sessionHeroImage);

    heroImage?.setAttribute("src", sessionHeroImage);
  </script>
</html>
